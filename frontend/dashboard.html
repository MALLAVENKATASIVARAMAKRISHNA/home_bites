<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Home Bites</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="dashboard">
    <!-- Navigation Bar -->
    <nav class="nav">
      <div class="brand">
        <img src="./assets/logo.png" alt="Home Bites logo" />
        <span>Home Bites</span>
      </div>
      <div class="user-info">
        <span id="userName">Loading...</span>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </nav>

    <!-- Main Dashboard Content -->
    <main class="dashboard-content">
      <h1>Welcome to your Dashboard</h1>
      <p>Browse our delicious home-cooked items and place your order</p>

      <div id="loadingMsg" style="text-align: center; padding: 40px; color: #999;">
        Loading items...
      </div>

      <div id="itemsGrid" class="items-grid" style="display: none;"></div>
    </main>
  </div>

  <script src="./config.js"></script>
  <script src="./ui.js"></script>
  <script>
    // Check authentication
    const token = localStorage.getItem('access_token');
    const user = JSON.parse(localStorage.getItem('user') || '{}');

    if (!token) {
      window.location.href = './index.html';
    }

    // Display user name
    document.getElementById('userName').textContent = user.name || 'User';

    // Logout function
    function logout() {
      localStorage.removeItem('access_token');
      localStorage.removeItem('user');
      window.location.href = './index.html';
    }

    // Load items from API
    async function loadItems() {
      const loadingMsg = document.getElementById('loadingMsg');
      const itemsGrid = document.getElementById('itemsGrid');

      try {
        const res = await fetch(`${API_BASE_URL}/items`);
        
        if (!res.ok) {
          throw new Error('Failed to load items');
        }

        const items = await res.json();
        
        loadingMsg.style.display = 'none';
        itemsGrid.style.display = 'grid';

        if (items.length === 0) {
          itemsGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999;">No items available yet.</p>';
          return;
        }

        itemsGrid.innerHTML = items.map(item => `
          <div class="item-card">
            <h3>${escapeHtml(item.item_name)}</h3>
            <p>${escapeHtml(item.description)}</p>
            <span class="weight">${escapeHtml(item.weight)}</span>
            <p class="price">â‚¹${item.price}</p>
          </div>
        `).join('');

      } catch (err) {
        loadingMsg.innerHTML = `<span style="color: var(--danger);">Error: ${err.message}</span>`;
        console.error('Failed to load items:', err);
      }
    }

    // Escape HTML to prevent XSS
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Load items on page load
    loadItems();
  </script>
</body>
</html>